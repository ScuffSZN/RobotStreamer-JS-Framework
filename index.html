<!DOCTYPE html>
<html>

<head>

</head>

<body>
<p>To run: <pre>connect([streamer robot_id])</pre></p>


    <script src="robotstreamer.js"></script>
    <script>

        
        var socket;

        
        var connect = async (i) => {
                var robot = await getOnline(i);
                if (robot.error == 0 && robot.online) {
                    console.log(robot)
                    setupWebsockets(await getControls(robot.robot_id))
                    setError(robot.error)
                } else if (robot.error == 0 && !robot.online) {
                    setError(3)
                } else if (robot.error == 4) {
                    setError(4)
                }
            },
            setError = (f) => {
                console.log(errors[f]);
            },
            setupWebsockets = (serv) => {
                console.log(serv)
                socket = new WebSocket("ws://"+serv+"/echo")
                // Connection opened
                socket.onopen = function() {
                    console.log('Websocket: ' + "ws://"+serv+"/echo");
                    var pref = {
                        command:"",                                        // !!STREAM KEY GOES HERE!!
                        token: ""
                    }
                    sendMessage(JSON.stringify(pref))
                    //sendMessage('{"command":"RS_PING"}')
                };

                socket.onmessage = function(data) {
                    //console.log(JSON.parse(data));
                    var msg = data
                    console.log(JSON.parse(msg.data))
                };

                socket.onclose = function(error){
                    console.log("socket closed")
                }
            },
            sendMessage = (m) => {
                console.log("sent: "+m)
                socket.send(m)
            }
    </script>
</body>

</html>
